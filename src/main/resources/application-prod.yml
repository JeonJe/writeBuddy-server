spring:
  datasource:
    hikari:
      maximum-pool-size: 3          # Railway 환경에서 더 보수적으로
      minimum-idle: 1               # 최소 1개만 유지
      connection-timeout: 30000     # 30초로 증가 (Railway 네트워크 지연 고려)
      idle-timeout: 120000          # 2분으로 줄임 (Supabase 타임아웃 고려)
      max-lifetime: 180000          # 3분으로 줄임 (Supabase 연결 안정성)
      leak-detection-threshold: 30000
      connection-init-sql: "SELECT 1"  # 연결 유효성 검사
      validation-timeout: 5000      # 검증 타임아웃
      initialization-fail-timeout: 30000  # 초기화 실패 타임아웃
      connection-test-query: "SELECT 1"  # 연결 테스트 쿼리
      test-while-idle: true         # 유휴 상태에서 연결 테스트
      test-on-borrow: true          # 대여 시 연결 테스트
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false                 # 프로덕션에서는 SQL 로그 비활성화
    format-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect  # 명시적 dialect 설정

# 서버 설정 (프로덕션용)
server:
  port: ${PORT:7071}
  address: 0.0.0.0
  tomcat:
    connection-timeout: 180s        # HTTP 연결 타임아웃 3분 (프로덕션에서 더 길게)
    threads:
      max: 100                      # 프로덕션에서는 스레드 수 줄임
      min-spare: 5

# OpenAI 타임아웃 설정 (프로덕션용)
openai:
  timeout:
    connect: 15     # 연결 타임아웃
    read: 90        # 읽기 타임아웃 90초 (프로덕션에서 더 길게)

logging:
  level:
    com.writebuddy: INFO
    com.writebuddy.writebuddy.config.ApplicationStartupListener: INFO  # 시작 로그 허용
    org.springframework.web: INFO   # 웹 요청 디버깅을 위해 INFO로 변경
    org.hibernate: WARN
    org.springframework.security: INFO  # 보안 필터 디버깅을 위해 INFO로 변경
    org.springframework.security.web: INFO
    com.zaxxer.hikari: INFO         # 연결 풀 정보
    org.postgresql: INFO            # PostgreSQL 드라이버 로그
    org.apache.catalina.connector: INFO  # Tomcat 연결 디버깅
    org.apache.coyote: INFO         # HTTP 프로토콜 디버깅
    root: INFO                      # 기본 로그 레벨
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} %5p [%t] %-40.40logger{39} : %m%n"
